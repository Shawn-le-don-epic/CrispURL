<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CrispURL - A Sleek URL Shortener</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React Libraries -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel for JSX compilation in the browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        /* Simple font import */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Main Application Component
        const App = () => {
            const [longUrl, setLongUrl] = useState('');
            const [shortUrl, setShortUrl] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [error, setError] = useState('');
            const [copySuccess, setCopySuccess] = useState('');

            // --- REAL API CALL to the Spring Boot Backend ---
            const handleShortenUrl = async () => {
                if (!longUrl || !isValidUrl(longUrl)) {
                    setError('Please enter a valid URL.');
                    return;
                }
                
                setIsLoading(true);
                setError('');
                setShortUrl('');
                setCopySuccess('');

                try {
                    // 1. Make the POST request to our backend
                    const response = await fetch('http://localhost:8081/api/shorten', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ longUrl: longUrl }),
                    });

                    // 2. Check if the request was successful
                    if (!response.ok) {
                        throw new Error('Something went wrong on the server.');
                    }

                    // 3. Get the JSON data from the response
                    const data = await response.json();
                    setShortUrl(data.shortUrl);
                    setLongUrl(''); // Clear input after success

                } catch (err) {
                    // 4. Handle any errors that occurred during the fetch
                    setError('Failed to shorten URL. Please try again.');
                    console.error(err);
                } finally {
                    // 5. This will run whether the request succeeded or failed
                    setIsLoading(false);
                }
            };

            // --- UTILITY FUNCTIONS ---
            const isValidUrl = (string) => {
                try {
                    new URL(string);
                    return true;
                } catch (_) {
                    return false;
                }
            };
            
            // --- COPY TO CLIPBOARD ---
            const copyToClipboard = () => {
                const textArea = document.createElement('textarea');
                textArea.value = shortUrl;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    setCopySuccess('Copied!');
                    setTimeout(() => setCopySuccess(''), 2000);
                } catch (err) {
                    setCopySuccess('Failed to copy');
                }
                document.body.removeChild(textArea);
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-indigo-900 via-purple-900 to-gray-900 flex items-center justify-center p-4">
                    <div className="w-full max-w-2xl">
                        {/* Header Section */}
                        <div className="text-center mb-8">
                            <h1 className="text-5xl md:text-6xl font-bold text-white tracking-tight">CrispURL</h1>
                            <p className="text-purple-300 mt-2 text-lg">The elegant way to shorten your links.</p>
                        </div>

                        {/* Main Glassmorphism Card */}
                        <div className="bg-white/10 backdrop-blur-xl border border-white/20 rounded-2xl shadow-2xl p-6 md:p-8">
                            <div className="flex flex-col md:flex-row gap-4">
                                <input
                                    type="url"
                                    value={longUrl}
                                    onChange={(e) => setLongUrl(e.target.value)}
                                    placeholder="https://your-very-long-and-unwieldy-link.com"
                                    className="w-full px-5 py-3 bg-white/10 text-white placeholder-gray-400 rounded-lg border-2 border-transparent focus:border-purple-400 focus:outline-none transition duration-300"
                                    disabled={isLoading}
                                />
                                <button
                                    onClick={handleShortenUrl}
                                    className="w-full md:w-auto px-8 py-3 bg-purple-600 text-white font-semibold rounded-lg hover:bg-purple-700 focus:outline-none focus:ring-4 focus:ring-purple-300 transition-all duration-300 disabled:bg-purple-400 disabled:cursor-not-allowed flex items-center justify-center"
                                    disabled={isLoading}
                                >
                                    {isLoading ? (
                                        <svg className="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                            <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                                            <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                        </svg>
                                    ) : (
                                        <span>Shorten</span>
                                    )}
                                </button>
                            </div>

                            {/* --- Display Area for Results, Errors, etc. --- */}
                            <div className="mt-6 min-h-[60px] flex items-center justify-center">
                                {error && (
                                    <p className="text-red-400 text-center">{error}</p>
                                )}
                                {shortUrl && (
                                    <div className="w-full bg-white/10 p-4 rounded-lg flex flex-col md:flex-row items-center justify-between gap-4">
                                        <a href={shortUrl} target="_blank" rel="noopener noreferrer" className="text-green-300 font-mono break-all hover:underline">
                                            {shortUrl}
                                        </a>
                                        <button 
                                            onClick={copyToClipboard}
                                            className="px-4 py-2 bg-green-600 text-white text-sm font-semibold rounded-lg hover:bg-green-700 transition duration-300 w-full md:w-auto"
                                        >
                                            {copySuccess || 'Copy'}
                                        </button>
                                    </div>
                                )}
                            </div>
                        </div>
                        <p className="text-center text-gray-500 mt-8 text-sm">
                            Designed with inspiration from modern UI principles.
                        </p>
                    </div>
                </div>
            );
        };

        // Render the App component using the new React 18 createRoot API
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>
